<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wanderer AI Debate Â· Control Room</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <div id="app">
      <div class="app-shell">
        <header class="topbar">
          <div class="brand">
            <span class="logo-dot"></span>
            <div>
              <div class="title">Wanderer AI Debate</div>
              <div class="subtitle">å®æ—¶è¾©è®ºç›‘æ§ Â· Web Control Room</div>
            </div>
          </div>
          <div class="connection">
            <span class="pill" :class="connection.state">{{ connectionLabel }}</span>
            <span class="time">{{ statusTime }}</span>
          </div>
        </header>

        <main class="grid">
          <section class="panel conversation">
              <div class="panel-header">
                <div>
                  <div class="panel-title">
                    å¯¹è¯æµ
                    <span class="current-topic-badge" v-if="status.topic">{{ status.topic }}</span>
                  </div>
                  <div class="panel-sub">å®æ—¶æ•æ‰æœ€æ–°è¾©è®ºå†…å®¹ï¼Œæ”¯æŒè‡ªåŠ¨ç¿»é¡µä¸æœç´¢</div>
                </div>
              <div class="panel-actions">
                <input class="input" v-model="filterText" placeholder="æœç´¢å…³é”®è¯" />
                <label class="toggle">
                  <input type="checkbox" v-model="autoScroll" />
                  è‡ªåŠ¨æ»šåŠ¨
                </label>
                <label class="toggle">
                  <input type="checkbox" v-model="autoPage" />
                  è‡ªåŠ¨ç¿»é¡µ
                </label>
                <button class="btn" @click="scrollToBottom">è·³åˆ°åº•éƒ¨</button>
              </div>
            </div>

            <div class="conversation-list" ref="listRef" @scroll="onScroll">
              <div class="load-more" v-if="hasMore">
                <button class="btn ghost" :disabled="loadingEarlier" @click="loadEarlier">
                  {{ loadingEarlier ? "åŠ è½½ä¸­..." : "åŠ è½½æ›´æ—©æ¶ˆæ¯" }}
                </button>
              </div>
              <div class="empty" v-if="!filteredEntries.length">æš‚æ— å¯¹è¯</div>
              <div
                class="entry"
                v-for="entry in filteredEntries"
                :key="entry.id"
                :class="entry.type"
              >
                <template v-if="entry.type === 'round'">
                  <div class="round-chip">Round {{ entry.round || '-' }}</div>
                  <div class="round-title">{{ entry.title }}</div>
                </template>
                <template v-else>
                  <div class="entry-header">
                    <span class="stage" v-if="entry.stage">{{ entry.stage }}</span>
                    <span class="agent" :class="entry.agent === 'A' ? 'agent-a' : 'agent-b'">
                      Agent {{ entry.agent || '-' }}
                    </span>
                    <span class="meta">Round {{ entry.round || '-' }}</span>
                    <span class="meta">{{ entry.timestamp || '-' }}</span>
                    <span class="topic" v-if="entry.topic">ä¸»é¢˜ï¼š{{ entry.topic }}</span>
                  </div>
                  <pre class="entry-body">{{ entry.body || "(ç©º)" }}</pre>
                </template>
              </div>
            </div>
          </section>

          <aside class="panel status">
            <div class="panel-header">
              <div>
                <div class="panel-title">ç³»ç»ŸçŠ¶æ€</div>
                <div class="panel-sub">è¿è¡Œå‚æ•°ã€API å¥åº·ä¸ token æ¶ˆè€—</div>
              </div>
              <div class="panel-actions">
                <button class="btn ghost" @click="refreshOnce">æ‰‹åŠ¨åˆ·æ–°</button>
              </div>
            </div>

            <div class="status-scroll">
              <div class="status-grid">
                <div class="card">
                  <div class="label">ä¸»é¢˜</div>
                  <div class="value">{{ status.topic || '-' }}</div>
                </div>
                <div class="card">
                  <div class="label">å½“å‰é˜¶æ®µ</div>
                  <div class="value">{{ status.debate_stage || '-' }}</div>
                </div>
                <div class="card">
                  <div class="label">è½®æ¬¡</div>
                  <div class="value">{{ status.round ?? '-' }}</div>
                </div>
                <div class="card">
                  <div class="label">è¾©è®ºè½®æ¬¡</div>
                  <div class="value">{{ status.debate_round ?? '-' }} / {{ status.debate_total_rounds ?? '-' }}</div>
                </div>
                <div class="card">
                  <div class="label">ä¸Šæ¬¡å›å¤</div>
                  <div class="value">{{ status.last_reply_at || '-' }}</div>
                </div>
                <div class="card">
                  <div class="label">A å¹³å‡åˆ†</div>
                  <div class="value">{{ status.judge?.average_scores?.A ? status.judge.average_scores.A.toFixed(2) : '-' }}</div>
                </div>
                <div class="card">
                  <div class="label">API çŠ¶æ€</div>
                  <div class="value" :class="apiStatusClass">
                    {{ apiStatusLabel }}
                  </div>
                </div>
                <div class="card">
                  <div class="label">B å¹³å‡åˆ†</div>
                  <div class="value">{{ status.judge?.average_scores?.B ? status.judge.average_scores.B.toFixed(2) : '-' }}</div>
                </div>
                <div class="card">
                  <div class="label">Token æ€»é‡</div>
                  <div class="value">
                    {{ status.token_stats?.total_tokens ? formatNumber(status.token_stats.total_tokens) : '-' }}
                  </div>
                </div>
                <div class="card">
                  <div class="label">Prompt å­—ç¬¦</div>
                  <div class="value" :class="promptState">{{ promptTotalLabel }}</div>
                  <div class="mini">{{ promptBreakdown }}</div>
                </div>
                <div class="card">
                  <div class="label">è¯·æ±‚æ¬¡æ•°</div>
                  <div class="value">{{ status.token_stats?.requests ?? '-' }}</div>
                </div>
                <div class="card wide">
                  <div class="label">é˜¶æ®µè§„åˆ™</div>
                  <div class="value">{{ status.debate_stage_rule || '-' }}</div>
                </div>
                <div class="card wide">
                  <div class="label">å­—æ•°æŒ‡å¯¼</div>
                  <div class="value">{{ status.debate_stage_length || '-' }}</div>
                </div>
                <div class="card wide" v-if="lastError">
                  <div class="label">æœ€è¿‘é”™è¯¯</div>
                  <div class="value error">{{ lastError }}</div>
                </div>
                <div class="card wide" v-if="status.judge?.overall_winner">
                  <div class="label">å½“å‰èƒœæ–¹</div>
                  <div class="value">{{ status.judge.overall_winner === 'A' ? 'âœ… æ­£æ–¹ A' : status.judge.overall_winner === 'B' ? 'âœ… åæ–¹ B' : 'ğŸ¤ å¹³å±€' }}</div>
                </div>
              </div>

              <div class="status-section" v-if="status.judge?.current_evaluation">
                <div class="section-title">æœ¬è½®è¯„åˆ†</div>
                <div class="judge-grid">
                  <div class="judge-card">
                    <div class="judge-title">A æ­£æ–¹</div>
                    <div class="judge-winner" v-if="status.judge.current_evaluation.round_winner === 'A'">ğŸ†</div>
                    <div class="judge-scores">
                      <div class="score-row"><span class="score-label">é€»è¾‘</span><span class="score-value">{{ status.judge.current_evaluation.scores?.A?.logic || '-' }}</span></div>
                      <div class="score-row"><span class="score-label">è¯æ®</span><span class="score-value">{{ status.judge.current_evaluation.scores?.A?.evidence || '-' }}</span></div>
                      <div class="score-row"><span class="score-label">ååº”</span><span class="score-value">{{ status.judge.current_evaluation.scores?.A?.responsiveness || '-' }}</span></div>
                      <div class="score-row"><span class="score-label">è¡¨è¾¾</span><span class="score-value">{{ status.judge.current_evaluation.scores?.A?.expression || '-' }}</span></div>
                      <div class="score-row"><span class="score-label">è§„åˆ™</span><span class="score-value">{{ status.judge.current_evaluation.scores?.A?.rule_compliance || '-' }}</span></div>
                    </div>
                    <div class="judge-avg">å¹³å‡: {{ status.judge.current_evaluation.averages?.A?.toFixed(2) || '-' }}</div>
                  </div>
                  <div class="judge-card">
                    <div class="judge-title">B åæ–¹</div>
                    <div class="judge-winner" v-if="status.judge.current_evaluation.round_winner === 'B'">ğŸ†</div>
                    <div class="judge-scores">
                      <div class="score-row"><span class="score-label">é€»è¾‘</span><span class="score-value">{{ status.judge.current_evaluation.scores?.B?.logic || '-' }}</span></div>
                      <div class="score-row"><span class="score-label">è¯æ®</span><span class="score-value">{{ status.judge.current_evaluation.scores?.B?.evidence || '-' }}</span></div>
                      <div class="score-row"><span class="score-label">ååº”</span><span class="score-value">{{ status.judge.current_evaluation.scores?.B?.responsiveness || '-' }}</span></div>
                      <div class="score-row"><span class="score-label">è¡¨è¾¾</span><span class="score-value">{{ status.judge.current_evaluation.scores?.B?.expression || '-' }}</span></div>
                      <div class="score-row"><span class="score-label">è§„åˆ™</span><span class="score-value">{{ status.judge.current_evaluation.scores?.B?.rule_compliance || '-' }}</span></div>
                    </div>
                    <div class="judge-avg">å¹³å‡: {{ status.judge.current_evaluation.averages?.B?.toFixed(2) || '-' }}</div>
                  </div>
                </div>
                <div class="judge-stats">
                  <span>å·²è¯„è½®æ¬¡: {{ status.judge.evaluated_rounds || '-' }}</span>
                  <span>ç´¯è®¡æ€»åˆ†: A {{ status.judge.cumulative_scores?.A?.toFixed(2) || '-' }} / B {{ status.judge.cumulative_scores?.B?.toFixed(2) || '-' }}</span>
                </div>
              </div>

              <div class="status-section" v-if="status.judge?.current_evaluation">
                <div class="section-title">è¯„å§”åé¦ˆ</div>
                <div class="clash-summary" v-if="status.judge.current_evaluation.clash_summary">
                  æ ¸å¿ƒå¯¹æŠ—ç‚¹ï¼š{{ status.judge.current_evaluation.clash_summary }}
                </div>
                <div class="judge-feedback">
                  <div class="feedback-card">
                    <div class="judge-title">A æ­£æ–¹</div>
                    <div class="feedback-block">
                      <div class="feedback-label">äº®ç‚¹</div>
                      <ul>
                        <li v-for="item in (status.judge.current_evaluation.highlights?.A || [])" :key="item">{{ item }}</li>
                        <li v-if="!(status.judge.current_evaluation.highlights?.A || []).length" class="muted">-</li>
                      </ul>
                    </div>
                    <div class="feedback-block">
                      <div class="feedback-label">å»ºè®®</div>
                      <ul>
                        <li v-for="item in (status.judge.current_evaluation.coaching?.A || status.judge.current_evaluation.suggestions?.A || [])" :key="item">{{ item }}</li>
                        <li v-if="!(status.judge.current_evaluation.coaching?.A || status.judge.current_evaluation.suggestions?.A || []).length" class="muted">-</li>
                      </ul>
                    </div>
                  </div>
                  <div class="feedback-card">
                    <div class="judge-title">B åæ–¹</div>
                    <div class="feedback-block">
                      <div class="feedback-label">äº®ç‚¹</div>
                      <ul>
                        <li v-for="item in (status.judge.current_evaluation.highlights?.B || [])" :key="item">{{ item }}</li>
                        <li v-if="!(status.judge.current_evaluation.highlights?.B || []).length" class="muted">-</li>
                      </ul>
                    </div>
                    <div class="feedback-block">
                      <div class="feedback-label">å»ºè®®</div>
                      <ul>
                        <li v-for="item in (status.judge.current_evaluation.coaching?.B || status.judge.current_evaluation.suggestions?.B || [])" :key="item">{{ item }}</li>
                        <li v-if="!(status.judge.current_evaluation.coaching?.B || status.judge.current_evaluation.suggestions?.B || []).length" class="muted">-</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <div class="identity-grid">
                <div class="card identity">
                  <div class="label">Agent A Plan</div>
                  <pre>{{ identities.identityA || "(ç©º)" }}</pre>
                </div>
                <div class="card identity">
                  <div class="label">Agent B Plan</div>
                  <pre>{{ identities.identityB || "(ç©º)" }}</pre>
                </div>
              </div>

              <div class="card experience">
                <div class="label">Experience (ç»éªŒæ€»ç»“)</div>
                <pre>{{ experience || "(ç©º)" }}</pre>
              </div>
            </div>
          </aside>
        </main>
      </div>
    </div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
